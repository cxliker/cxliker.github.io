<!DOCTYPE html>
<html lang>
  <head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">

<meta name="theme-color" content="#f8f5ec">
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="HTB Beep Writeup"><meta name="keywords" content="sec|secruity|blog"><link rel="alternate" href="/atom.xml" title="danta"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.1">
<link rel="canonical" href="https://danta.fun/2019/12/16/HTB-Beep-Writeup/">

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css"><link rel="stylesheet" type="text/css" href="/lib/nprogress/nprogress.min.css">
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.1">

<script id="baidu_analytics">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?1fb3396bc01d62b8be6fcb651441065c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script><script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script src="//cdn1.lncld.net/static/js/3.1.1/av-min.js"></script>
  <script id="leancloud">
    AV.init({
      appId: "92CcA9DvqYFSomQnzdApeHt9-gzGzoHsz",
      appKey: "gAPpmDXQmTGE9s9a3eU4nJ0h"
    });
  </script><script>
  window.config = {"leancloud":{"app_id":"92CcA9DvqYFSomQnzdApeHt9-gzGzoHsz","app_key":"gAPpmDXQmTGE9s9a3eU4nJ0h"},"toc":true,"fancybox":true,"pjax":true,"latex":false};
</script>

    <title>HTB Beep Writeup - danta</title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">danta</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/archives/">
        <li class="mobile-menu-item">文章
          </li>
      </a><a href="/links">
        <li class="mobile-menu-item">链接
          </li>
      </a><a href="/about">
        <li class="mobile-menu-item">关于
          </li>
      </a><a href="/atom.xml">
        <li class="mobile-menu-item">RSS
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">danta</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            文章
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/links">
            链接
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/about">
            关于
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/atom.xml">
            RSS
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><article class="post">
    <header class="post-header">
      <h1 class="post-title">HTB Beep Writeup
        </h1>

      <div class="post-meta">
        <span class="author">
          danta
        </span>
        <span class="post-time">
          2019-12-16 22:00
        </span><span class="post-visits" data-url="/2019/12/16/HTB-Beep-Writeup/" data-title="HTB Beep Writeup">
          阅读次数 0
        </span>
        </div>
    </header>

    <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x00-前言"><span class="toc-text">0x00 前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-信息收集"><span class="toc-text">0x01 信息收集</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Web"><span class="toc-text">Web</span></a></li></ol>
    </div>
  </div><div class="post-content"><h1 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h1><p>这是一篇writeup，靶机是来自hackthebox的<a href="https://www.hackthebox.eu/home/machines/profile/5" target="_blank" rel="noopener">Beep</a></p>
<h1 id="0x01-信息收集"><a href="#0x01-信息收集" class="headerlink" title="0x01 信息收集"></a>0x01 信息收集</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/htb/beep<span class="comment"># ports=$(nmap -PN -p- --min-rate=1000 -T4 10.10.10.7 | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ','| sed s/,$//)</span></span><br><span class="line">root@kali:~/htb/beep<span class="comment"># nmap -p$ports -sC -sV 10.10.10.7</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2019-12-16 09:24 EST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.7</span><br><span class="line">Host is up (0.34s latency).</span><br><span class="line"></span><br><span class="line">PORT     STATE SERVICE    VERSION</span><br><span class="line">22/tcp   open  ssh        OpenSSH 4.3 (protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   1024 ad:ee:5a:bb:69:37:fb:27:af:b8:30:72:a0:f9:6f:53 (DSA)</span><br><span class="line">|_  2048 bc:c6:73:59:13:a1:8a:4b:55:07:50:f6:65:1d:6d:0d (RSA)</span><br><span class="line">25/tcp   open  smtp       Postfix smtpd</span><br><span class="line">|_smtp-commands: beep.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, ENHANCEDSTATUSCODES, 8BITMIME, DSN,</span><br><span class="line">80/tcp   open  http       Apache httpd 2.2.3</span><br><span class="line">|_http-server-header: Apache/2.2.3 (CentOS)</span><br><span class="line">|_http-title: Did not follow redirect to https://10.10.10.7/</span><br><span class="line">|_https-redirect: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">110/tcp  open  pop3       Cyrus pop3d 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4</span><br><span class="line">|_pop3-capabilities: RESP-CODES EXPIRE(NEVER) LOGIN-DELAY(0) USER TOP AUTH-RESP-CODE IMPLEMENTATION(Cyrus POP3 server v2) STLS PIPELINING UIDL APOP</span><br><span class="line">111/tcp  open  rpcbind    2 (RPC <span class="comment">#100000)</span></span><br><span class="line">143/tcp  open  imap       Cyrus imapd 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4</span><br><span class="line">|_imap-capabilities: MULTIAPPEND CHILDREN Completed CONDSTORE IDLE SORT=MODSEQ ATOMIC QUOTA IMAP4 MAILBOX-REFERRALS THREAD=REFERENCES SORT X-NETSCAPE UNSELECT LIST-SUBSCRIBED LISTEXT OK CATENATE NO ANNOTATEMORE URLAUTHA0001 THREAD=ORDEREDSUBJECT RIGHTS=kxte IMAP4rev1 BINARY ID ACL LITERAL+ RENAME UIDPLUS STARTTLS NAMESPACE</span><br><span class="line">443/tcp  open  ssl/https?</span><br><span class="line">|_ssl-date: 2019-12-16T15:29:00+00:00; +1h00m45s from scanner time.</span><br><span class="line">993/tcp  open  ssl/imap   Cyrus imapd</span><br><span class="line">|_imap-capabilities: CAPABILITY</span><br><span class="line">995/tcp  open  pop3       Cyrus pop3d</span><br><span class="line">3306/tcp open  mysql?</span><br><span class="line">|_mysql-info: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">5038/tcp open  asterisk   Asterisk Call Manager 1.1</span><br><span class="line">Service Info: Hosts:  beep.localdomain, 127.0.0.1, example.com</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: 1h00m44s</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 394.04 seconds</span><br></pre></td></tr></table></figure>

<p>因为直接全扫太慢了，所以分开两次扫，第一次粗扫，对第一次的结果再细扫。不过没想到居然开了这么多端口。。</p>
<p>80打开是一个<code>Elastix</code>，网上搜了一下默认密码，还包括MySql数据库的默认密码，尝试登录80或3306都不成功。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/htb/beep<span class="comment"># mysql -h 10.10.10.7 -u root -p</span></span><br><span class="line">Enter password:</span><br><span class="line">ERROR 1130 (HY000): Host <span class="string">'10.10.14.9'</span> is not allowed to connect to this MySQL server</span><br></pre></td></tr></table></figure>

<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><p>查了下<code>Elastix</code>好像是个电话服务器，是<code>asterisk</code>的后台管理页面。</p>
<p>查一下cve</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[0] % searchsploit elastix</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------- ------------------------------------------------------------</span><br><span class="line"> Exploit Title                                                                                                                                 |  Path</span><br><span class="line">                                                                                                                                               | (/usr/<span class="built_in">local</span>/opt/exploitdb/share/exploitdb/)</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------- ------------------------------------------------------------</span><br><span class="line">Elastix - <span class="string">'page'</span> Cross-Site Scripting                                                                                                          | exploits/php/webapps/38078.py</span><br><span class="line">Elastix - Multiple Cross-Site Scripting Vulnerabilities                                                                                        | exploits/php/webapps/38544.txt</span><br><span class="line">Elastix 2.0.2 - Multiple Cross-Site Scripting Vulnerabilities                                                                                  | exploits/php/webapps/34942.txt</span><br><span class="line">Elastix 2.2.0 - <span class="string">'graph.php'</span> Local File Inclusion                                                                                               | exploits/php/webapps/37637.pl</span><br><span class="line">Elastix 2.x - Blind SQL Injection                                                                                                              | exploits/php/webapps/36305.txt</span><br><span class="line">Elastix &lt; 2.5 - PHP Code Injection                                                                                                             | exploits/php/webapps/38091.php</span><br><span class="line">FreePBX 2.10.0 / Elastix 2.2.0 - Remote Code Execution                                                                                         | exploits/php/webapps/18650.py</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------- ------------------------------------------------------------</span><br><span class="line">Shellcodes: No Result</span><br></pre></td></tr></table></figure>

<p>稍微试了几个，LFI的漏洞是可利用的：</p>
<p><img src="/image/9.jpg" alt></p>
<p>有了密码之后就可以登录了。</p>
<p>也尝试了代码执行的CVE，但是需要一个电话号码。翻看了下后台找到一个号码：</p>
<p><img src="/image/10.jpg" alt></p>
<p>那么那就弹个shell吧，使用<a href="http://www.exploit-db.com/exploits/18649" target="_blank" rel="noopener">http://www.exploit-db.com/exploits/18649</a>来getshell，但是代码中的payload并不奏效，那就从owefsad大佬的文章<a href="https://exexute.github.io/2019/04/24/how-get-a-reverse-shell/" target="_blank" rel="noopener">how get a reverse shell</a>随手挑一个payload试一下。</p>
<p>没想到这就登录进来了，还是ROOT权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[0] % nc -lv 443</span><br><span class="line">sh: no job control <span class="keyword">in</span> this shell</span><br><span class="line">sh-3.2<span class="comment"># ls</span></span><br><span class="line">user.txt</span><br><span class="line">sh-3.2<span class="comment"># whoami</span></span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<p>最后看了下别人的writeup，原来那个密码就是ssh的root账号密码。密码复用的问题还是值得重视。</p>

      </div>
      <footer class="post-footer">
        
        <nav class="post-nav"><a class="prev" href="/2019/12/18/HTB-Lame-Writeup/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">HTB Lame Writeup</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    <a class="next" href="/2019/12/15/PlaidCTF-2013-ropasaurusrex-writeup/">
        <span class="next-text nav-default">PlaidCTF 2013 ropasaurusrex writeup - PWN</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></footer>
    </article></div><div class="comments" id="comments"><div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:cxliker@qq.com" class="iconfont icon-email" title="email"></a>
        <a href="https://github.com/okdanta" class="iconfont icon-github" title="github"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://hexo.io/">Hexo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">&copy;2018 - 2020<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">danta</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'https://danta.fun/2019/12/16/HTB-Beep-Writeup/';
        this.page.identifier = '2019/12/16/HTB-Beep-Writeup/';
        this.page.title = 'HTB Beep Writeup';
    };
    (function() {
    var d = document, s = d.createElement('script');

    s.src = '//cxliker.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();  
  </script><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/lib/pjax/jquery.pjax.min.js"></script>
  <script type="text/javascript" src="/lib/nprogress/nprogress.min.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.1"></script>
</body>
</html>
